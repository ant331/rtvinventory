function checkForNewNotifications() {
                const logs = getMovementLogs();
                const notifications = getNotifications();
                const itemMap = new Map(getInventoryData().map(item => [item.id, item]));
                const existingNotifIds = new Set(notifications.map(n => n.id));
                const newNotifications = [];

                logs.forEach(log => {
                    const notifId = `notif-${log.timestamp}-${log.itemId}`;
                    if (existingNotifIds.has(notifId)) return;

                    let message = null;
                    let type = null; // <-- ADD THIS

                    if (log.action === 'return_to_store') {
                        const item = itemMap.get(log.itemId);
                        message = `<strong>${item?.name || log.itemId}</strong> requires approval. ${log.details}`;
                        type = 'approval'; // <-- ADD THIS
                    } else if (log.action === 'incident_report') {
                        const item = itemMap.get(log.itemId);
                        message = `Incident reported for <strong>${item?.name || log.itemId}</strong>.`;
                        type = 'incident'; // <-- ADD THIS
                    }

                    if (message) {
                        // Add type and itemId to the notification object
                        newNotifications.push({ id: notifId, message, timestamp: log.timestamp, read: false, type: type, itemId: log.itemId });
                    }
                });

                if (newNotifications.length > 0) {
                    saveNotifications([...newNotifications, ...notifications]);
                }
            }
            
            function updateNotificationsUI() {
                const notifications = getNotifications();
                const unreadCount = notifications.filter(n => !n.read).length;
                notificationCount.textContent = unreadCount;
                notificationCount.style.display = unreadCount > 0 ? 'flex' : 'none';
                
                notificationList.innerHTML = '';
                if (notifications.length === 0) {
                    notificationList.innerHTML = '<p style="text-align:center; padding: 1rem; color: var(--secondary);">No new notifications.</p>';
                    return;
                }

                notifications.forEach(notif => {
                    const itemEl = document.createElement('div');
                    itemEl.className = 'notification-item';
                    
                    // Add data attributes and a pointer cursor if it's an actionable notification
                    if (notif.type && notif.itemId) {
                        itemEl.dataset.type = notif.type;
                        itemEl.dataset.itemId = notif.itemId;
                        itemEl.style.cursor = 'pointer';
                        itemEl.title = 'Click to view';
                    }

                    const icon = notif.message.includes('approval') ? 'fa-inbox' : 'fa-exclamation-triangle';
                    itemEl.innerHTML = `
                        <i class="fas ${icon} notification-icon"></i>
                        <div class="notification-content">
                            <p>${notif.message}</p>
                            <small>${new Date(notif.timestamp).toLocaleString()}</small>
                        </div>`;
                    notificationList.appendChild(itemEl);
                });
            }

            function handleApproval(itemId) {
                let currentInventory = getInventoryData();
                const itemIndex = currentInventory.findIndex(item => item.id === itemId);

                if (itemIndex > -1) {
                    currentInventory[itemIndex].status = 'available';
                    currentInventory[itemIndex].district = 'mbarara';
                    currentInventory[itemIndex].lastUpdate = new Date().toLocaleDateString();
                    
                    logMovement(itemId, 'approval_complete', 'Item return from field office approved by Admin.');
                    localStorage.setItem(INVENTORY_KEY, JSON.stringify(currentInventory));
                    
                    updateAllUI();
                }
            }

            function setupEventListeners() {
                document.getElementById('logout-btn').addEventListener('click', () => {
                    sessionStorage.removeItem('loggedInUser');
                    window.location.href = 'login.html';
                });

                const modal = document.getElementById('districtModal');
                document.getElementById('viewAllDistrictsBtn').onclick = () => { modal.style.display = 'flex'; };
                document.querySelector('.modal-close').onclick = () => { modal.style.display = 'none'; };
                window.onclick = (event) => { if (event.target == modal) modal.style.display = 'none'; };

                notificationBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    notificationDropdown.style.display = notificationDropdown.style.display === 'block' ? 'none' : 'block';
                });
                
                clearNotificationsBtn.addEventListener('click', () => {
                    if (getNotifications().length > 0 && confirm('Are you sure you want to clear all notifications?')) {
                        saveNotifications([]);
                        updateNotificationsUI();
                    }
                });

                document.addEventListener('click', () => {
                    notificationDropdown.style.display = 'none';
                });

                notificationDropdown.addEventListener('click', (e) => e.stopPropagation());

                // New Event Listener for handling clicks on notifications
                notificationList.addEventListener('click', (e) => {
                    const notificationItem = e.target.closest('.notification-item');
                    if (!notificationItem) return;

                    const type = notificationItem.dataset.type;
                    const itemId = notificationItem.dataset.itemId;

                    if (!type || !itemId) return; // Not an actionable notification

                    // Hide dropdown after click
                    notificationDropdown.style.display = 'none';

                    if (type === 'approval') {
                        const approvalCard = document.getElementById('approval-card');
                        if (approvalCard && approvalCard.style.display !== 'none') {
                            // Scroll to the approval card
                            approvalCard.scrollIntoView({ behavior: 'smooth', block: 'center' });

                            // Add a temporary highlight effect for better UX
                            approvalCard.style.transition = 'box-shadow 0.3s ease-in-out';
                            approvalCard.style.boxShadow = '0 0 0 3px var(--info)';
                            setTimeout(() => {
                                approvalCard.style.boxShadow = '';
                            }, 2000);
                        }
                    } else if (type === 'incident') {
                        // Redirect to inventory page, passing itemID as a query parameter
                        // The Inventory.html page would need to be updated to handle this parameter
                        window.location.href = `Inventory.html?highlight=${itemId}`;
                    }
                });

                refreshBtn.addEventListener('click', () => {
                    const icon = refreshBtn.querySelector('i');
                    icon.classList.add('fa-spin');
                    updateAllUI();
                    setTimeout(() => icon.classList.remove('fa-spin'), 500);
                });
                
                document.getElementById('approval-list-container').addEventListener('click', (e) => {
                    const approveBtn = e.target.closest('.approve-btn');
                    if (approveBtn) {
                        const itemId = approveBtn.dataset.itemId;
                        handleApproval(itemId);
                    }
                });

                window.addEventListener('storage', updateAllUI);
            }
